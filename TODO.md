The code is a bit of a mess (quick and dirty), needs a good deal of refactoring and better error checking/handling.
